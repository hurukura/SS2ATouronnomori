<html>

<head>
	<meta charset="utf-8">
	<title>討論の杜 | アカウントプロフィール</title>
	<h1>討論の杜</h1>
	<h2></h2>
	<div id="info"></div>
	<form>
		<button type="button" id="logout" class="hide">ログアウト</button>
	</form>
	<h3>アカウントプロフィール</h3>
</head>

<body>

	<!--    モジュール   -->

	<!--    firebase    -->
	<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-auth.js"></script>
	<!--    firestoe    -->
	<script src="https://www.gstatic.com/firebasejs/6.5.0/firebase-firestore.js"></script>

	<!--    設定読み込み   -->
	<script src="js/config.js"></script>


	<img src="" id="icon">
	<div id="username">ユーザー名 : now loading･･･</div>
	<div id="seibetu">性別 : now loading･･･</div>
	<div id="nendai">年代 : now loading･･･</div>

	<a href="acount_setting.html">アカウントの設定へ</a>
	<h3>過去に参加した討論</h3>


	<script src="js/auth.js"></script>

</body>


<script>

	let uname = document.querySelector('#username');
	let useibetu = document.querySelector('#seibetu');
	let unendai = document.querySelector('#nendai');



	//遷移元から値を受け取る
	var query = location.search;
	var value = query.split('=');
	var uid = value[1];

	console.log('遷移元から受け取ったUID＝' + uid);


	//firestore定義
	const db = firebase.firestore();
	var docRef = db.collection("users").doc(value[1]);

	// データの読み取り

	docRef.get().then((doc) => {
			if (doc.exists) {
				console.log(doc.data());

				unendai = doc.data()["nendai"];
				useibetu = doc.data()["seibetu"];
				uname = doc.data()["username"];

				//年代と性別を設定していない場合
				if (useibetu == undefined && unendai == undefined) {
					useibetu = "未設定";
					unendai = "未設定";
				}

				console.log(unendai, useibetu, uname);

				showAcountProf('ユーザー名 : ' + uname, '性別 : ' + useibetu, '年代 : ' + unendai);


			} else {
				console.log("404");
				console.log('アカウントが見つからないので3秒後に討論画面へ戻ります。');
				setTimeout(history.back(), waitTimer * 3000);
			}
		})
		.catch((error) => {
			console.log(`データを取得できませんでした (${error})`);
		});

	// データの読み取りここまで

	/**
	 * メッセージ表示
	 **/

	function showAcountProf(fname, fseibetu, fnendai) {
		document.querySelector('#username').innerText = fname;

		document.querySelector('#seibetu').innerText = fseibetu;

		document.querySelector('#nendai').innerText = fnendai;

	}
</script></html>
