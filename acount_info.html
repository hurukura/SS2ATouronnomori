<html>

<head>
	<meta charset="utf-8">
	<title>討論の杜 | アカウントプロフィール</title>
	<h1>討論の杜</h1>
	<h3>Acount Status</h3>
	<h2>アカウントプロフィール</h2>
</head>

<body>
	<div id="info"></div>
	<!--    モジュール   -->

	<!--    firebase    -->
	<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-auth.js"></script>
	<!--    firestoe    -->
	<script src="https://www.gstatic.com/firebasejs/6.5.0/firebase-firestore.js"></script>

	<!--    設定読み込み   -->
	<script src="js/config.js"></script>


	<img src="" id="icon">
	<div id="username">na</div>
	<div id="seibetu">se</div>
	<div id="nendai">nen</div>

	<a href="acount_setting.html">アカウントの設定へ</a>
	<h2>過去に参加した討論</h2>

	<button type="button" id="logout" class="hide">ログアウト</button>


</body>

<script>
	firebase.auth().onAuthStateChanged((user) => {
		let logout = document.getElementById("logout");

		let h3 = document.querySelector('h3');
		let uname = document.querySelector('#username');
		let useibetu = document.querySelector('#seibetu');
		let unendai = document.querySelector('#nendai');

		//-----------------------------------
		// ログインチェック
		//-----------------------------------
		if (!user) {
			showMessage('Not Login');
			logout.classList.add("hide");
			window.location.href = 'login.php';
			return (false);
		}

		//-----------------------------------
		// ログイン者への処理
		//-----------------------------------
		// ログインメッセージ

		console.log(user);
		showMessage('ログイン中 : ' + user.displayName + 'さん');

		// ログアウトボタンを表示
		logout.classList.remove("hide");

		//uidの取得
		var Tuid = firebase.auth().currentUser.uid;

		//firestore定義
		const db = firebase.firestore();
		var docRef = db.collection("users").doc(user.uid);

		// データの読み取り


		// データの読み取りここまで

		docRef.get().then((doc) => {
				if (doc.exists) {
					console.log(doc.data());
					
					unendai = doc.data()["nendai"];
					useibetu = doc.data()["seibetu"];
					uname = doc.data()["username"];
					
					console.log(unendai,useibetu,uname);
					
					showAcountProf('アカウント名 : ' + uname,'性別 : ' + useibetu,'年代 : ' + unendai);
					
					
				} else {
					console.log("404");
				}
			})
			.catch((error) => {
				console.log(`データを取得できませんでした (${error})`);
			});
		

		// ------------------------
		// ログアウトボタンを押下
		// ------------------------
		logout.addEventListener("click", () => {
			firebase.auth().signOut().then(() => {
					console.log("ログアウトしました");

					//アラートを表示
					window.alert('ログアウトしました。またきてね');
					//OKでログイン画面へ遷移
					window.location.href = 'login.html'
				})
				.catch((error) => {
					console.log(`ログアウト時にエラーが発生しました (${error})`);
				});
		});
	});


	/**
	 * メッセージ表示
	 **/
	function showMessage(title) {
		document.querySelector('h3').innerText = title;
	}

	function showAcountProf(fname, fseibetu, fnendai) {
		document.querySelector('#username').innerText = fname;

		document.querySelector('#seibetu').innerText = fseibetu;

		document.querySelector('#nendai').innerText = fnendai;

	}

</script>



</html>
