<head>
	<meta charset="utf-8">
	<title>定刻処理用</title>
</head>

<body>
	<div>
		<input type="button" id="run_btn" value="実行">
	</div>

	<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/6.5.0/firebase-firestore.js"></script>
	<script src="js/config.js"></script>
	<script>
		const db = firebase.firestore();

		const docRef = db.collection("chatroom").doc("room3");

		var today = new Date();
		var year = String(today.getFullYear()).slice(-2);
		var month = String(today.getMonth() + 1);
		var day = String(today.getDate());
		console.log(year + ":" + month + ":" + day);

		document.getElementById("run_btn").onclick = move1(year, month, day);
		document.getElementById("run_btn").onclick = move2(year, month, day);

		function move1(y, m, d){
			const docRef1 = docRef.collection("messages");
			docRef1.get().then(function(querySnapshot) {
				querySnapshot.forEach(function(doc) {
					db.collection("results").doc(y + m + d).collection("messages").add({

						date: doc.data()["date"],
						flag: doc.data()["flag"],
						id: doc.data()["id"],
						msg: doc.data()["msg"],
						name: doc.data()["name"]
					})
						.then(function(docRef) {
						console.log("Document written with ID: ", docRef.id);
					})
						.catch(function(error) {
						console.error("Error adding document: ", error);
					});
				});
			});
		}

		function move2(y, m, d) {
			console.log("move2");
			const docRef1 = docRef.collection("roominfo");
			docRef1.get().then(function(querySnapshot) {
				querySnapshot.forEach(function(doc) {
					db.collection("results").doc(y + m + d).collection("roominfo").add({
						flag: doc.data()["flag"],
						theme: doc.data()["theme"],
						users: doc.data()["users"]
					})
						.then(function(docRef) {
						console.log("Document written with ID: ", docRef.id);
					})
						.catch(function(error) {
						console.error("Error adding document: ", error);
					});
				});
			});
		}

	</script>

</body>
