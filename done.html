<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="c_home.css">
	<title>討論の杜</title>
</head>

<body>
	<div class="domannaka">
		<h1>...Please wait</h1>
		<div id="info" style="text-align: center"></div>
	</div>
	<style>
		.domannaka {
			position: absolute;
			top: 50%;
			left: 50%;
			-webkit-transform: translate(-50%, -50%);
			transform: translate(-50%, -50%);
			width: 300px;
			text-align: center;
			/*一応BOX内の文字も中央寄せ*/
		}
	</style>

	<!--    モジュール   -->

	<!--    firebase auth   -->
	<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-auth.js"></script>

	<!--    firestoe    -->
	<script src="https://www.gstatic.com/firebasejs/6.5.0/firebase-firestore.js"></script>

	<!--    モジュールここまで   -->

	<script src="./config.js"></script>
	<script>
		//firestore定義
		const db = firebase.firestore();
		const docRef = db.collection("users");

		//認証
		firebase.auth().onAuthStateChanged((user) => {
			let h1 = document.querySelector('h1');
			let info = document.querySelector('#info');

			if (user) {
				h1.innerText = 'ようこそ！';
				info.innerHTML = `${user.displayName}さん`;
				console.log(user);

				//uidの取得
				var Tuid = firebase.auth().currentUser.uid;

				//ユーザー情報の書き込み　1回のみ（それ以降のログインではエラー）　特に問題はない
				db.collection("users").doc(Tuid).set({
						userId: Tuid,
						username: user.displayName,
						email: user.email,
					})
					.then(function() {
						console.log("Document successfully written!");
					})
					.catch(function(error) {
						console.error("Error writing document: ", error);
					});

			} else {
				h1.innerText = 'Not Login';
				window.location.href = 'login.php';
			}
		});

	</script>

	<script type="text/javascript">
		// 一定時間経過後に指定ページにジャンプする
		waitTimer = 3; // 何秒後に移動する
		url = "http://localhost/kaihatsu/home.html"; // 移動するアドレス
		function jumpPage() {
			location.href = url;
		}
		setTimeout("jumpPage()", waitTimer * 1000)
		//

	</script>


</body>

</html>
